<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ClubCalenderMapper">

    <resultMap id="clubCalenderSelect" type="clubCalender">
        <result property="clubCalenderNum"    column="club_calendar_num"    jdbcType="INTEGER"/>
        <result property="clubNum"            column="club_num"             jdbcType="INTEGER"/>
        <result property="regDate"            column="reg_date"              jdbcType="DATE"/>
        <result property="calenderTitle"      column="calendar_title"       jdbcType="VARCHAR"/>
        <result property="calenderText"       column="calendar_text"        jdbcType="VARCHAR"/>
        <result property="clubDate"           column="club_date"            jdbcType="DATE"/>
        <result property="location"           column="location"             jdbcType="VARCHAR"/>
        <result property="noticeCheck"        column="notice_check"         jdbcType="VARCHAR"/>
        <result property="noticeTime"         column="notice_time"          jdbcType="VARCHAR"/>
        <result property="calendarApplyCheck" column="calendar_apply_check" jdbcType="VARCHAR"/>
        <result property="applyAutoCheck"     column="apply_auto_check"     jdbcType="VARCHAR"/>
        <result property="boardCategory"      column="board_category"       jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="calenderReviewSelect" type="calenderReview">
        <result property="clubCalenderReviewNum"    column="club_calendar_review_num"    jdbcType="INTEGER"/>
        <result property="clubCalenderNum"          column="club_calendar_num"           jdbcType="INTEGER"/>
        <result property="clubNum"                  column="club_num"                    jdbcType="INTEGER"/>
        <result property="userId"            column="user_id"                     jdbcType="VARCHAR"/>
        <result property="reviewRange"              column="review_range"                jdbcType="VARCHAR"/>
        <result property="reviewTitle"              column="review_title"                jdbcType="VARCHAR"/>
        <result property="reviewText"               column="review_text"                 jdbcType="VARCHAR"/>
        <result property="regDate"                  column="reg_date"                    jdbcType="DATE"/>
        <result property="viewCount"                column="view_count"                  jdbcType="INTEGER"/>
        <result property="likeConunt"               column="like_count"                  jdbcType="INTEGER"/>
        <result property="updateDate"               column="update_date"                 jdbcType="DATE"/>
        <result property="boardCategory"            column="board_category"              jdbcType="INTEGER"/>
    </resultMap>

    <resultMap type="com.project.domain.File" id="FileResultMap">
        <result property="fileNum" column="file_num" jdbcType="INTEGER"/>
        <result property="boardNum" column="board_num" jdbcType="VARCHAR"/>
        <result property="boardCategory" column="board_category" jdbcType="VARCHAR"/>
        <result property="fileName" column="file_name" jdbcType="INTEGER"/>
    </resultMap>

    <!--모임 일정 -->
    <insert id="addClubCalender" parameterType="clubCalender">
        INSERT INTO
            club_calendar(club_calendar_num, club_num,reg_date,calendar_title,calendar_text,club_date,location,notice_check,notice_time,calendar_apply_check,apply_auto_check)
            values(  SEQ_CLUB_CALENDAR.nextval
                ,#{clubNum}
                ,SYSDATE
                ,#{calenderTitle}
                ,#{calenderText}
                ,#{clubDate}
                ,#{location}
                ,#{noticeCheck}
                ,#{noticeTime}
                ,#{calendarApplyCheck}
                ,#{applyAutoCheck})
    </insert>

    <update id="updateClubCalender" parameterType="clubCalender">
        UPDATE
            club_calendar
            <set>
                calender_title=#{calenderTitle}
                ,calender_text=#{calenderText}
                ,location = #{location}
                ,notice_check = #{noticeCheck}
                ,notice_time=#{noticeTime}
                ,calender_apply_check = #{calenderApplyCheck}
                ,apply_auto_check=#{applyAutoCheck}
                ,reg_date = SYSDATE
            </set>
            WHERE club_calender_num = #{clubCalenderNum}
    </update>

    <delete id="deleteClubCalender" parameterType="clubCalender">
        DELETE club_calendar
        WHERE club_calendar_num = #{clubCalenderNum}
    </delete>

    <select id="getClubCalender"    parameterType="int"  resultMap="clubCalenderSelect">
        SELECT *
        FROM club_calendar
        WHERE club_calendar_num = #{clubCalenderNum}
    </select>

    <select id="getListCalender"    parameterType="clubCalender" resultMap="clubCalenderSelect">
        SELECT * FROM club_calendar
        WHERE club_num = #{clubNum}
    </select>
    <!--모임 일정 후기글-->
    <insert id="addCalenderReview" parameterType="calenderReview" useGeneratedKeys="true" >
        INSERT INTO
        <if test="boardCategory == 1">
            club_calendar_review (club_calendar_review_num,club_calendar_num,club_num,user_id,review_range,review_title,review_text,reg_date,board_category)
            VALUES (seq_club_calendar_review.NEXTVAL
                    ,#{clubCalenderNum}
                    ,#{clubNum}
                    ,#{userId}
                    ,#{reviewRange}
                    ,#{reviewTitle}
                    ,#{reviewText}
                    ,SYSDATE
                    ,#{boardCategory}
                    )
        </if>
        <if test="boardCategory == 2">
            club_calendar_review(club_calendar_review_num,club_calendar_num,club_num,user_id,review_range,review_title,board_category,reg_date)
            VALUES (seq_club_calendar_review.NEXTVAL
                ,#{clubCalenderNum}
                ,#{clubNum}
                ,#{userId}
                ,#{reviewRange}
                ,#{reviewTitle}
                ,#{boardCategory}
                ,SYSDATE)
        </if>
        <selectKey keyProperty="clubCalenderReviewNum" resultType="int" order="AFTER">
           SELECT seq_club_calendar_review.CURRVAL FROM DUAL
        </selectKey>
    </insert>

    <update id="updateCalenderReview" parameterType="calenderReview">
        UPDATE club_calendar_review
        <if test="boardCategory == 1">
            <set>
                review_range = #{reviewRange}
                ,review_title = #{reviewTitle}
                ,review_text = #{reviewText}
                ,update_date = SYSDATE
             </set>
        </if>
        <if test="boardCategory == 2">
            <set>
                review_range  = #{reviewRange}
                ,review_title = #{reviewTitle}
                ,update_date  = SYSDATE
            </set>
        </if>
        WHERE club_calendar_review_num = #{clubCalenderReviewNum}
    </update>

    <select id="getCalenderReview" parameterType="map"  resultMap="calenderReviewSelect">
        SELECT *
        FROM club_calendar_review
        WHERE club_calendar_review_num = #{clubCalenderReviewNum}
    </select>

    <select id="listCalenderReview" parameterType="int" resultMap="calenderReviewSelect">
        select * from CLUB_CALENDAR_REVIEW
        WHERE BOARD_CATEGORY = #{boardCategory}
        AND REVIEW_RANGE = '1'
    </select>

    <!--파일 등록-->
    <insert id="addFileUpload" parameterType="map">
        INSERT
        INTO files(file_num,
                   board_num,
                   board_category,
                   file_name)
        VALUES (seq_files.NEXTVAL, #{boardNum}, #{boardCategory}, #{fileName})
    </insert>

    <select id="getListFile" parameterType="map" resultMap="FileResultMap">
        SELECT *
        FROM files
        WHERE board_num = #{boardNum}
            AND board_category = #{boardCategory}
        ORDER BY file_num DESC
    </select>



</mapper>
