<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="DealMapper">
    <resultMap id="DealSelectMap" type="deal">
        <result property="dealBoardNum" column="deal_board_num" jdbcType="INTEGER"/>
        <result property="boardCategory" column="board_category" jdbcType="CHAR"/>
        <result property="dealStatus" column="deal_status" jdbcType="CHAR"/>
        <result property="user.userId" column="user_id" jdbcType="VARCHAR"/>
        <result property="dealTitle" column="deal_title" jdbcType="VARCHAR"/>
        <result property="dealText" column="deal_text" jdbcType="VARCHAR"/>
        <result property="dealRegDate" column="deal_reg_date" jdbcType="DATE"/>
        <result property="productName" column="product_name" jdbcType="VARCHAR"/>
        <result property="price" column="price" jdbcType="INTEGER"/>
        <result property="tag" column="deal_tag" jdbcType="VARCHAR"/>
        <result property="viewCount" column="view_count" jdbcType="INTEGER"/>
        <result property="villCode" column="vill_code" jdbcType="VARCHAR"/>
        <result property="dealId" column="deal_id" jdbcType="VARCHAR"/>
        <result property="dealModeCheck" column="deal_mode_check" jdbcType="CHAR"/>
        <result property="charNum" column="char_num" jdbcType="INTEGER"/>
        <result property="review" column="review" jdbcType="VARCHAR"/>
        <result property="reviewPt" column="review_pt" jdbcType="INTEGER"/>
        <result property="dealEndDate" column="deal_end_date" jdbcType="DATE"/>
        <result property="dealDate" column="deal_date" jdbcType="DATE"/>
        <result property="dealLocation" column="deal_location" jdbcType="VARCHAR"/>
    </resultMap>
<!--게시물 작성-->
    <insert id="addDeal" parameterType="deal">
        INSERT INTO deal(deal_board_num,
                         board_category,
                         deal_status,
                         user_id,
                         deal_title,
                         deal_text,
                         deal_reg_date,
                         product_name,
                         price,
                         tag,
                         view_count,
                         vill_code)
values (seq_deal.NEXTVAL,
        #{boardCategory},
        #{dealStatus},
        #{user.userId},
        #{dealTitle},
        #{dealText},
        SYSDATE,
        #{productName},
        #{price:NUMERIC},
        #{tag},
        #{viewCount:NUMERIC},
        #{villCode})
    </insert>
<!--    &lt;!&ndash;게시물 상세조회&ndash;&gt;-->
    <select id="getDeal" parameterType="int" resultMap="DealSelectMap">
        SELECT
            deal_board_num,
            user_id,
            deal_title,
            deal_text,
            price,
            product_name,
            tag
from deal
where deal_board_num=#{dealBoardNum}
    </select>
    <!--신뢰온도,
           파일-->
<!--    &lt;!&ndash;게시물 수정&ndash;&gt;-->
    <update id="updateDeal" parameterType="deal">
    UPDATE DEAL
<set>
        deal_title=#{dealTitle:VARCHAR},
        deal_status=#{dealStatus:CHAR},
        deal_text=#{dealText:VARCHAR},

    product_name=#{productName:VARCHAR},
        price=#{price:NUMERIC},
        tag=#{tag:VARCHAR}
</set>

        <where> deal_board_num=#{dealBoardNum}</where>
    </update>
    <!--게시물 삭제-->
    <delete id="deleteDeal" parameterType="int">
        DELETE deal
        <where>
            deal_board_num=#{dealBoardNum}
        </where>
    </delete>
    <!--게시물 목록 조회.. .-->
    <select id="getListDeal" parameterType="search" resultMap="DealSelectMap">
        SELECT *
        FROM (	SELECT inner_table.* , ROWNUM AS row_seq
        FROM		(	SELECT deal_board_num, deal_title, deal_text, user_id, deal_reg_date ,tag
        FROM deal
        <if test="searchCondition != null">
            <where>
                <if test="searchCondition == 0 and searchKeyword !='' ">
                    deal_title = #{searchKeyword}
                </if>
                <if test="searchCondition == 1 and searchKeyword !='' ">
                    tag = #{searchKeyword}
                </if>
            </where>
        </if>
        ORDER BY deal_board_num ) inner_table
        WHERE ROWNUM >= 0 )

    </select>

<!--    WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}-->


    <select  id="getTotalCount"  parameterType="search"	 resultType="int">
        SELECT COUNT(*)
        FROM(	SELECT deal_board_num,deal_title,deal_text
        FROM deal
        <if test="searchCondition != null">
            <where>
                <if test="searchCondition == 0 and searchKeyword !='' ">
                    deal_board_num= to_char(#{searchKeyword})
                </if>
                <if test="searchCondition == 1 and searchKeyword !='' ">
                    tag = ${searchKeyword}
                </if>
            </where>
        </if> ) countTable
    </select>

</mapper>